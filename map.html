<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tugbo Flood Hazard Map</title>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.css" rel="stylesheet" />
  <style>
    html,body,#map{height:100%;margin:0}
    .controls {
      position:absolute; top:12px; left:12px; z-index:2;
      background:#fff; border:1px solid #ddd; border-radius:8px;
      box-shadow:0 2px 10px rgba(0,0,0,.08); padding:10px 12px;
      font:14px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    .legend .row{display:flex;align-items:center;gap:8px;margin-top:6px}
    .legend .swatch{width:16px;height:16px;border-radius:3px;border:1px solid #999}
    .credit {
      position:absolute; right:12px; bottom:12px; background:#fff; padding:6px 8px;
      border:1px solid #ddd; border-radius:6px; font:12px/1.3 system-ui; color:#333;
    }
    .popup {font:13px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Arial}
    .popup .h {font-weight:600;margin-bottom:4px}
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Legend -->
  <div class="controls legend" id="legend">
    <div style="font-weight:600;margin-bottom:6px">Flood Hazard</div>
    <div class="row"><span class="swatch" style="background:#b3e5fc"></span>Low</div>
    <div class="row"><span class="swatch" style="background:#4fc3f7"></span>Moderate</div>
    <div class="row"><span class="swatch" style="background:#0288d1"></span>High</div>
  </div>

  <div class="credit">Source: GEE (NASADEM, CHIRPS) â€¢ Styled in Mapbox Studio</div>

  <script src="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.js"></script>
  <script>
  mapboxgl.accessToken = 'pk.eyJ1Ijoia3lhaGFuenp6IiwiYSI6ImNtZGR2YmpqMDA4enIya29zY21nY3hxMjQifQ.U3RNv0EJn1yPHwF41JZALA';

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/kyahanzzz/cmfjf7zxm005001sb5h4e21av',
    center: [123.639, 12.349],
    zoom: 15
  });

  map.addControl(new mapboxgl.NavigationControl({ visualizePitch:true }), 'top-right');
  map.addControl(new mapboxgl.FullscreenControl(), 'top-right');
  map.addControl(new mapboxgl.ScaleControl({ unit:'metric' }), 'bottom-right');

  // Use the Layer ID shown at the top of your layer panel in Studio
  const FILL_LAYER_ID = 'tugbo-hazard-polygons-9czz71';

  map.on('load', () => {
    const popup = new mapboxgl.Popup({ closeButton: true, closeOnClick: true, maxWidth: '280px' });

    // Click to show hazard value
    map.on('click', (e) => {
      const feats = map.queryRenderedFeatures(e.point, { layers: [FILL_LAYER_ID] });
      if (!feats.length) return;
      const f = feats[0];
      const hazard = f.properties && (f.properties.hazard || f.properties.hazard_cls || f.properties.hazard_code);
      const value = hazard !== undefined ? hazard : '(no value)';
      popup
        .setLngLat(e.lngLat)
        .setHTML(`<div class="popup"><div class="h">Hazard class</div>${value}</div>`)
        .addTo(map);
    });

    // Pointer cursor on hover
    map.on('mouseenter', FILL_LAYER_ID, () => map.getCanvas().style.cursor = 'pointer');
    map.on('mouseleave', FILL_LAYER_ID, () => map.getCanvas().style.cursor = '');
  });
  </script>
</body>
</html>
