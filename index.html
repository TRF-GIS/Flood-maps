<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TRiFlooDS</title>
  <meta name="description" content="TRiFlooDS — Interactive flood hazard map for the Tugbo River AOI." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.css" rel="stylesheet" />
  <style>
    :root{--bg-1:#081826;--bg-2:#0e2941;--glass:#0f2137cc;--border:#2a3a4b;--fg:#eaf2f8;--muted:#a9bfd2;--accent:#22a6f2;--accent-2:#17d1ff;--card:#0f2137a6;--chip:#122a43;--shadow:0 10px 30px rgba(0,0,0,.25);--radius:16px;--radius-lg:24px}
    @media (prefers-color-scheme:light){:root{--bg-1:#eef5fb;--bg-2:#dfeaf5;--glass:#ffffffcc;--border:#e7edf5;--fg:#0f2235;--muted:#4f6a80;--card:#ffffffd9;--chip:#eef3f9;--shadow:0 10px 30px rgba(3,33,62,.12)}}
    *{box-sizing:border-box} html,body{height:100%;margin:0}
    body{font:16px/1.55 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--fg);background:
      radial-gradient(1200px 900px at 10% -10%, #11385e 0%, transparent 60%),
      radial-gradient(1000px 700px at 90% 20%, #0c3850 0%, transparent 55%),
      linear-gradient(160deg, var(--bg-1), var(--bg-2))}
    .wrap{width:min(1200px,96vw);margin-inline:auto;padding:20px 0 40px}
    .topbar{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,var(--glass),transparent);backdrop-filter:saturate(130%) blur(8px);border-bottom:1px solid var(--border)}
    .topbar .inner{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:10px min(2vw,16px)}
    .brand{display:flex;align-items:center;gap:12px;font-weight:800;letter-spacing:.2px;font-size:18px}
    .brand .logo{inline-size:36px;block-size:36px;border-radius:10px;background:conic-gradient(from 200deg at 70% 30%,var(--accent),var(--accent-2));box-shadow:0 6px 16px rgba(34,166,242,.35)}
    .nav{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
    .nav a{color:var(--fg);text-decoration:none;font-weight:600;opacity:.9;padding:8px 10px;border-radius:10px;border:1px solid transparent}
    .nav a:hover{opacity:1;background:var(--card);border-color:var(--border)}
    .hero{position:relative;overflow:hidden;border-radius:var(--radius-lg);background:var(--glass);border:1px solid var(--border);box-shadow:var(--shadow);padding:38px clamp(18px,4vw,44px);display:grid;grid-template-columns:1.15fr .85fr;gap:28px}
    @media (max-width:980px){.hero{grid-template-columns:1fr}}
    .hero h1{font-size:clamp(30px,5vw,56px);line-height:1.05;margin:0 0 12px}
    .hero p{color:var(--muted);margin:8px 0 18px}
    .cta{display:flex;flex-wrap:wrap;gap:12px;margin-top:14px}
    .btn{appearance:none;border:0;cursor:pointer;text-decoration:none;font-weight:700;letter-spacing:.2px;color:#04131f;background:linear-gradient(135deg,var(--accent),var(--accent-2));padding:12px 18px;border-radius:12px;box-shadow:0 8px 20px rgba(34,166,242,.35);transition:.2s transform ease,.2s box-shadow ease}
    .btn:hover{transform:translateY(-2px);box-shadow:0 12px 26px rgba(34,166,242,.45)}
    .btn.alt{background:transparent;color:var(--fg);border:1px solid var(--border);box-shadow:none}
    .btn.alt:hover{border-color:#3a5974;background:#0e2237aa}
    .card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:16px;display:grid;grid-template-rows:auto auto 1fr;gap:12px}
    .minimap{position:relative;block-size:260px;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:#0b1e2e}
    #miniMap{height:100%;width:100%}
    .legend{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .lg-btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:var(--chip);color:var(--muted);padding:8px 12px;border-radius:999px;font-weight:700;cursor:pointer}
    .lg-dot{inline-size:12px;block-size:12px;border-radius:999px;border:1px solid var(--border)}
    .lg-low{background:#70e0b5}.lg-mod{background:#ffb56b}.lg-high{background:#ff7a7a}.lg-vhigh{background:#3d24ff}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:var(--chip);color:var(--muted);border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:13px}
    .strip{display:grid;gap:10px;grid-template-columns:repeat(4,1fr);margin-top:14px}
    @media (max-width:980px){.strip{grid-template-columns:1fr 1fr}}
    .stat{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px 14px}
    .stat small{color:var(--muted)} .stat strong{display:block;font-size:22px;margin-top:2px}
    footer{text-align:center;margin-top:22px;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="topbar" role="navigation" aria-label="Top navigation">
    <div class="wrap inner">
      <div class="brand"><span class="logo" aria-hidden="true"></span> TRiFlooDS</div>
      <nav class="nav">
        <a href="#about">About</a>
        <a href="#read">How to read</a>
        <a href="#sources">Data</a>
        <a id="navPredictive" href="./predictive.html">Predictive</a>
        <a id="navHistorical" href="./historical.html">Historical</a>
        <a href="./map.html">Open Map</a>
        <a href="./map-new.html">Open New Map</a>
      </nav>
    </div>
  </div>

  <div class="wrap" role="main">
    <section class="hero section" aria-label="Intro">
      <div>
        <h1>Explore Flood Hazard for the Tugbo River AOI</h1>
        <p>
          Interactive hazard classes (<strong>Low</strong> · <strong>Moderate</strong> · <strong>High</strong> ·
          <strong>Very High</strong>) derived from NASADEM terrain, Sentinel-1 (SAR), CHIRPS rainfall, and topographic
          proxies in Google Earth Engine; styled in Mapbox Studio.
        </p>

        <div class="cta">
          <a class="btn" href="./map.html">Open Map</a>
          <a class="btn" href="./rain-sim.html">Rain Simulation</a>
          <a class="btn" id="btnPredictive" href="./predictive.html">Predictive (2026–2030)</a>
          <a class="btn" id="btnHistorical" href="./historical.html">Historical (2021–2025)</a>
          <a class="btn alt" href="https://studio.mapbox.com/styles/kyahanzzz/cmfjf7zxm005001sb5h4e21av/" target="_blank" rel="noopener">View in Mapbox Studio</a>
        </div>

        <div class="strip" aria-label="Quick stats">
          <div class="stat"><small>Center</small><strong>123.639,<br />12.349</strong></div>
          <div class="stat"><small>Default zoom</small><strong>15</strong></div>
          <div class="stat"><small>AOI size</small><strong>~1.1 km²</strong></div>
          <div class="stat"><small>Last update</small><strong id="lastUpdated">—</strong></div>
        </div>
      </div>

      <aside class="card" aria-label="Preview">
        <div class="minimap"><div id="miniMap"></div></div>
        <div class="legend" aria-label="Legend">
          <button type="button" class="lg-btn"><span class="lg-dot lg-low"></span>Low</button>
          <button type="button" class="lg-btn"><span class="lg-dot lg-mod"></span>Moderate</button>
          <button type="button" class="lg-btn"><span class="lg-dot lg-high"></span>High</button>
          <button type="button" class="lg-btn"><span class="lg-dot lg-vhigh"></span>Very High</button>
        </div>
        <div class="chips">
          <span class="chip">Sentinel-1 (SAR)</span>
          <span class="chip">NASADEM DEM</span>
          <span class="chip">CHIRPS Rainfall</span>
          <span class="chip">HAND / Slope / Distance</span>
          <span class="chip">Vector polygons</span>
        </div>
      </aside>
    </section>

    <section id="about" class="section"></section>
    <section id="read" class="section"></section>
    <section id="sources" class="section"></section>

    <footer>© <span id="y"></span> TRiFlooDS • Built with Mapbox GL JS • <a href="./map.html" style="color:inherit">Open Map</a></footer>
  </div>

  <script src="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.js"></script>
  <script>
    // Footer date
    (function () {
      const now = new Date(), pad = n => String(n).padStart(2, '0');
      document.getElementById('y').textContent = now.getFullYear();
      document.getElementById('lastUpdated').textContent =
        `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`;
    })();

    // Mapbox token + mini map
    mapboxgl.accessToken = 'pk.eyJ1Ijoia3lhaGFuenp6IiwiYSI6ImNtZGR2YmpqMDA4enIya29zY21nY3hxMjQifQ.U3RNv0EJn1yPHwF41JZALA';
    const HERO_STYLE_URL = 'mapbox://styles/kyahanzzz/cmgglgun3009x01ri1tf89vud';

    const mini = new mapboxgl.Map({
      container: 'miniMap',
      style: HERO_STYLE_URL,
      center: [123.639, 12.349],
      zoom: 15,
      pitch: 0,
      bearing: 0,
      interactive: true
    });

    mini.addControl(new mapboxgl.NavigationControl({ visualizePitch: false, showCompass: false }), 'top-right');

    // -------- Predictive link auto-fix (GitHub Pages safe) ----------
    (function fixPredictiveLinks(){
      const btn = document.getElementById('btnPredictive');
      const nav = document.getElementById('navPredictive');

      // Build absolute URLs from current location so it works under /repo/ too
      const rel = (file) => new URL(file, window.location.href).toString();

      function exists(url){
        // HEAD is supported on GitHub Pages. Fallback to GET if blocked by a proxy.
        return fetch(url, { method: 'HEAD' }).then(r => r.ok).catch(() =>
          fetch(url, { method: 'GET', mode: 'no-cors' }).then(() => true).catch(() => false)
        );
      }

      const canonical = rel('./predictive.html');
      const legacy    = rel('./Predective.html'); // in case the old filename is present

      Promise.resolve()
        .then(() => exists(canonical))
        .then(ok => {
          if (ok) { btn.href = canonical; nav.href = canonical; return; }
          return exists(legacy).then(ok2 => {
            if (ok2) { btn.href = legacy; nav.href = legacy; return; }
            // Neither exists — disable visually to avoid 404s
            btn.classList.add('alt'); btn.style.cursor = 'not-allowed'; btn.title = 'Upload predictive.html to enable';
            btn.addEventListener('click', e => e.preventDefault());
            nav.style.opacity = '.5'; nav.style.pointerEvents = 'none'; nav.title = 'Upload predictive.html to enable';
          });
        })
        .catch(() => {/* swallow errors to avoid breaking the page on GH Pages */});
    })();
  </script>
</body>
</html>
